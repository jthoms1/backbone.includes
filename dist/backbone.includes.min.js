/*! backbone.includes - v0.1.0 - 2013-11-15 */(function(e,t){"use strict";if("function"==typeof define&&define.amd)define(["backbone","underscore"],function(e,i){t(e,i)});else if("undefined"!=typeof exports){var i=require("underscore"),s=require("backbone");t(s,i)}else t(e.Backbone,e._)})(this,function(e,t){"use strict";function i(e){return e.charAt(0).toUpperCase()+e.slice(1)}var s={getModelName:function(){return this.modelName||this.model.modelName},setIncludes:function(){return this._includesList={},t.each(arguments,function(e){var i=[];if(t.isArray(e)){var s=e.shift();i=e,e=s}this._includesList[e.prototype.getModelName()]={modelOrCollection:e,subIncludes:i}},this),this},_buildIncludes:function(e){var i=[];return t.each(e,function(e,t){var s=t;e.subIncludes.length>0&&(s+="/"+e.subIncludes[0].prototype.getModelName()),i.push(s)}),i.join()}},n={set:t.wrap(e.Model.prototype.set,function(e,t,i,s){return e.call(this,t,i,s),this._updateIncludesMethods(),this}),_updateIncludesMethods:function(){var e={};this._includesList?e=this._includesList:this.collection&&this.collection._includesList&&(e=this.collection._includesList),t.each(e,function(e,t){this._includeMethod(e.modelOrCollection,t,e.subIncludes)},this)},_includeMethod:function(e,s,n){var u="get"+i(s);t.isArray(this.get(s))?u+="s":e=e.prototype.model||e,this[u]=this._getAttributeMethod(e,s,n)},_getAttributeMethod:function(e,t,i){var s=this;return function(){if(this._includedListValues=this._includedListValues||{},s._includedListValues[t])return s._includedListValues[t];var n=s._includedListValues[t]=new e;return n.setIncludes.apply(n,i),n.set(s.get(t)),n}},sync:t.wrap(e.Model.prototype.sync,function(e,i,s,n){return this._includesList&&(n.data=t.extend({includes:this._buildIncludes(this._includesList)},n.data||{})),e.call(this,i,s,n)})},u={sync:t.wrap(e.Collection.prototype.sync,function(e,i,s,n){return this._includesList&&(n.data=t.extend({includes:this._buildIncludes(this._includesList)},n.data||{})),e.call(this,i,s,n)})};t.extend(e.Model.prototype,n,s),t.extend(e.Collection.prototype,u,s)});